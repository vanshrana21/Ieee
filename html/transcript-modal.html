<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcript Modal - Juris AI</title>
    <link rel="stylesheet" href="../css/transcript-modal.css">
</head>
<body>
    <!-- Transcript Modal -->
    <div id="transcript-modal" class="modal">
        <div class="modal-content transcript-modal">
            <div class="modal-header">
                <h2>üìù COURTROOM TRANSCRIPT</h2>
                <div class="modal-actions">
                    <button class="btn-export" onclick="transcriptController.exportTranscript()">
                        üì• Export
                    </button>
                    <button class="close-btn" onclick="transcriptController.closeModal()">&times;</button>
                </div>
            </div>
            
            <div class="modal-body">
                <!-- Audio Recording Controls (NEW) -->
                <div class="audio-recording-section">
                    <div class="recording-header">
                        <h4>üéôÔ∏è Audio Recording</h4>
                        <span id="recording-status" class="recording-status">Ready</span>
                    </div>
                    
                    <!-- Waveform Visualization -->
                    <div class="waveform-container">
                        <canvas id="waveform-canvas" width="600" height="100"></canvas>
                    </div>
                    
                    <!-- Recording Controls -->
                    <div class="recording-controls">
                        <button id="btn-start-recording" class="btn-record start">
                            üî¥ Start Recording
                        </button>
                        <button id="btn-stop-recording" class="btn-record stop hidden">
                            ‚èπ Stop Recording
                        </button>
                    </div>
                    
                    <!-- Speaker Selection -->
                    <div class="speaker-selection">
                        <label>Current Speaker:</label>
                        <div class="speaker-buttons">
                            <button class="speaker-btn active" data-role="petitioner" onclick="transcriptController.setSpeakerRole('petitioner')">
                                üü£ Petitioner
                            </button>
                            <button class="speaker-btn" data-role="respondent" onclick="transcriptController.setSpeakerRole('respondent')">
                                üü¢ Respondent
                            </button>
                            <button class="speaker-btn" data-role="judge" onclick="transcriptController.setSpeakerRole('judge')">
                                ‚öñÔ∏è Judge
                            </button>
                        </div>
                    </div>
                    
                    <!-- Chunk Progress Indicators -->
                    <div class="chunk-progress-container">
                        <label>Chunk Progress:</label>
                        <div id="chunk-progress" class="chunk-progress">
                            <!-- Chunk indicators added dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Manual Entry Fallback -->
                <div id="manual-entry-panel" class="manual-entry-panel hidden">
                    <p class="fallback-message">‚ö†Ô∏è Microphone not available. Use manual entry:</p>
                </div>

                <!-- Transcript Filter -->
                <div class="transcript-filter">
                    <select id="filter-type" onchange="transcriptController.applyFilter()">
                        <option value="">All Entry Types</option>
                        <option value="statement">Statements</option>
                        <option value="question">Questions</option>
                        <option value="answer">Answers</option>
                        <option value="objection">Objections</option>
                        <option value="ruling">Rulings</option>
                    </select>
                    <select id="filter-side" onchange="transcriptController.applyFilter()">
                        <option value="">All Sides</option>
                        <option value="petitioner">Petitioner</option>
                        <option value="respondent">Respondent</option>
                    </select>
                    <button class="btn-refresh" onclick="transcriptController.loadTranscript()">üîÑ Refresh</button>
                </div>

                <!-- Transcript Content -->
                <div id="transcript-content" class="transcript-content">
                    <div class="transcript-loading">
                        <p>Loading transcript...</p>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <div class="transcript-stats">
                    <span id="entry-count">0 entries</span>
                    <span id="last-updated"></span>
                </div>
                <div class="footer-actions">
                    <button id="finalize-transcript-btn" class="btn finalize hidden" onclick="transcriptController.finalizeTranscript()">
                        ‚úì Finalize Transcript
                    </button>
                    <button class="btn secondary" onclick="transcriptController.closeModal()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Transcript Quick View Panel -->
    <div id="transcript-panel" class="transcript-panel">
        <div class="panel-header">
            <h3>üìù Live Transcript</h3>
            <div class="panel-actions">
                <button class="btn-expand" onclick="transcriptController.openModal()">‚õ∂</button>
            </div>
        </div>
        <div id="transcript-preview" class="transcript-preview">
            <div class="preview-empty">
                <p>No transcript entries yet</p>
            </div>
        </div>
        <div class="panel-footer">
            <button class="btn primary" onclick="transcriptController.openModal()">
                View Full Transcript
            </button>
        </div>
    </div>

    <!-- Add Entry Panel (For judges/court reporters) -->
    <div id="add-entry-panel" class="add-entry-panel hidden">
        <h4>Add Transcript Entry</h4>
        <div class="entry-form">
            <select id="entry-speaker">
                <option value="">Select Speaker</option>
                <option value="judge">Judge</option>
                <option value="petitioner_counsel">Petitioner Counsel</option>
                <option value="respondent_counsel">Respondent Counsel</option>
            </select>
            <select id="entry-type">
                <option value="statement">Statement</option>
                <option value="question">Question</option>
                <option value="answer">Answer</option>
                <option value="procedural">Procedural</option>
            </select>
            <textarea id="entry-content" placeholder="Enter transcript text..."></textarea>
            <button class="btn primary" onclick="transcriptController.addEntry()">
                Add Entry
            </button>
        </div>
    </div>

    <script src="../js/transcript-controller.js"></script>
    <script>
        // Initialize with round ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const roundId = urlParams.get('round_id') || 1;
        const transcriptController = new TranscriptController(roundId);
    </script>
</body>
</html>
