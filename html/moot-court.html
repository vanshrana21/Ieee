<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moot Court | Juris AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/moot-court.css">
</head>
<body>
    <nav class="navbar">
        <div class="navbar-content">
            <div class="logo">Juris AI</div>
            <div class="navbar-right">
                <span class="navbar-module-label">Moot Court</span>
                <button class="back-btn" onclick="window.location.href='ai-practice.html'">ðŸ¤– AI Practice</button>
                <button class="back-btn" onclick="window.location.href='dashboard-student.html'">Dashboard</button>
            </div>
        </div>
    </nav>

    <main class="container">
        <!-- ==================== -->
        <!-- PROJECT LIST VIEW    -->
        <!-- ==================== -->
        <section id="projectListView" class="view">
            <div class="view-header">
                <div>
                    <h1 class="view-title">Moot Court Workspace</h1>
                    <p class="view-subtitle">Prepare, structure, and practice legal arguments like trained advocates.</p>
                </div>
                <button class="btn-primary" id="newProjectBtn">+ New Moot</button>
            </div>

            <div class="projects-grid" id="projectsGrid">
                <!-- Populated by JS -->
            </div>

            <div class="empty-state" id="emptyState">
                <div class="empty-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    </svg>
                </div>
                <h3>No moot projects yet</h3>
                <p>Create your first moot court project to begin structuring arguments.</p>
                <button class="btn-primary" id="emptyNewProjectBtn">Create First Moot</button>
            </div>
        </section>

        <!-- ==================== -->
        <!-- CREATE PROJECT VIEW  -->
        <!-- ==================== -->
        <section id="createProjectView" class="view hidden">
            <div class="view-header">
                <button class="btn-text" id="backToListBtn">&larr; Back to Projects</button>
            </div>

            <div class="form-container">
                <h2 class="form-title">New Moot Court Project</h2>

                <div class="form-group">
                    <label class="form-label" for="mootTitle">Moot Title <span class="required">*</span></label>
                    <input type="text" id="mootTitle" class="form-input" placeholder="e.g. National Moot Court Competition 2026 â€” Problem No. 3">
                </div>

                <div class="form-group">
                    <label class="form-label" for="mootProposition">Moot Proposition / Problem Statement <span class="required">*</span></label>
                    <textarea id="mootProposition" class="form-textarea" rows="8" placeholder="Paste the full moot proposition, case facts, or problem statement here..."></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="mootSide">Your Side <span class="required">*</span></label>
                        <div class="side-selector">
                            <button class="side-btn" data-side="petitioner" id="sidePetitioner">Petitioner</button>
                            <button class="side-btn" data-side="respondent" id="sideRespondent">Respondent</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="mootCourt">Court / Forum</label>
                        <input type="text" id="mootCourt" class="form-input" placeholder="e.g. Supreme Court of India, High Court, ICSID Tribunal">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="mootDomain">Legal Domain</label>
                    <input type="text" id="mootDomain" class="form-input" placeholder="e.g. Constitutional Law, Criminal Law, International Arbitration">
                </div>

                <div class="form-actions">
                    <button class="btn-secondary" id="cancelCreateBtn">Cancel</button>
                    <button class="btn-primary" id="createProjectBtn">Create Moot Project</button>
                </div>
            </div>
        </section>

        <!-- ==================== -->
        <!-- WORKSPACE VIEW       -->
        <!-- ==================== -->
        <section id="workspaceView" class="view hidden">
            <div class="workspace-header">
                <div class="workspace-nav">
                    <button class="btn-text" id="backToProjectsBtn">&larr; All Projects</button>
                </div>
                <div class="workspace-meta">
                    <h2 class="workspace-title" id="workspaceTitle"></h2>
                    <div class="workspace-badges">
                        <span class="badge badge-side" id="workspaceSide"></span>
                        <span class="badge badge-court" id="workspaceCourt"></span>
                        <span class="badge badge-domain" id="workspaceDomain"></span>
                    </div>
                </div>
                <div class="workspace-actions">
                    <button class="btn-icon btn-oral" id="enterOralRoundBtn" title="Enter Oral Round Mode">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
                        <span>Oral Round</span>
                    </button>
                    <button class="btn-icon btn-eval" id="openEvaluationBtn" title="Open Evaluation Panel">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                        <span>Evaluate</span>
                    </button>
                    <button class="btn-icon btn-ai-toggle" id="toggleCoachBtn" title="Open AI Moot Coach">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                        <span>AI Coach</span>
                    </button>
                    <button class="btn-icon btn-ai-toggle" id="toggleJudgeAssistBtn" title="Open Judge Assist">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                        <span>Judge Assist</span>
                    </button>
                    <button class="btn-icon" id="viewPropositionBtn" title="View Moot Proposition">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
                        <span>Proposition</span>
                    </button>
                    <button class="btn-icon btn-danger" id="deleteProjectBtn" title="Delete Project">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                    </button>
                </div>
            </div>

            <!-- Proposition Panel (collapsible) -->
            <div class="proposition-panel hidden" id="propositionPanel">
                <div class="proposition-header">
                    <span class="proposition-label">Moot Proposition</span>
                    <button class="btn-close" id="closePropositionBtn">&times;</button>
                </div>
                <div class="proposition-body" id="propositionBody"></div>
            </div>

            <!-- Issues + IRAC Layout -->
            <div class="workspace-layout">
                <!-- Left: Issue List -->
                <div class="issues-panel">
                    <div class="issues-header">
                        <h3 class="panel-title">Legal Issues</h3>
                        <button class="btn-small" id="addIssueBtn">+ Add Issue</button>
                    </div>
                    <p class="panel-hint">Frame each legal issue as a separate argument track. Drag to reorder by priority.</p>
                    <div class="issues-list" id="issuesList">
                        <!-- Populated by JS -->
                    </div>
                    <div class="issues-empty hidden" id="issuesEmpty">
                        <p>No issues framed yet. Add your first legal issue to begin structuring arguments.</p>
                    </div>
                </div>

                <!-- Right: IRAC Builder -->
                <div class="irac-panel" id="iracPanel">
                    <div class="irac-empty" id="iracEmpty">
                        <div class="irac-empty-icon">
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                        </div>
                        <h3>Select an issue to begin</h3>
                        <p>Choose a legal issue from the panel on the left to open its IRAC workspace.</p>
                    </div>

                    <div class="irac-workspace hidden" id="iracWorkspace">
                        <div class="irac-workspace-header">
                            <div class="irac-issue-nav">
                                <button class="btn-small btn-ghost" id="prevIssueBtn" title="Previous Issue">&larr;</button>
                                <span class="irac-issue-counter" id="iracIssueCounter"></span>
                                <button class="btn-small btn-ghost" id="nextIssueBtn" title="Next Issue">&rarr;</button>
                            </div>
                            <div class="irac-status" id="iracStatus"></div>
                        </div>

                        <div class="irac-section">
                            <div class="irac-label">
                                <span class="irac-letter">I</span>
                                <span class="irac-name">Issue</span>
                            </div>
                            <textarea id="iracIssue" class="irac-textarea" rows="3" placeholder="State the legal question this issue raises. Frame it precisely as a question of law."></textarea>
                        </div>

                        <div class="irac-section">
                            <div class="irac-label">
                                <span class="irac-letter">R</span>
                                <span class="irac-name">Rule</span>
                            </div>
                            <textarea id="iracRule" class="irac-textarea" rows="5" placeholder="State the legal principle, statutory provision, or precedent applicable to this issue."></textarea>
                        </div>

                        <div class="irac-section">
                            <div class="irac-label">
                                <span class="irac-letter">A</span>
                                <span class="irac-name">Application</span>
                            </div>
                            <textarea id="iracApplication" class="irac-textarea" rows="6" placeholder="Apply the rule to the facts of the moot proposition. Connect law to fact with reasoning."></textarea>
                        </div>

                        <div class="irac-section">
                            <div class="irac-label">
                                <span class="irac-letter">C</span>
                                <span class="irac-name">Conclusion</span>
                            </div>
                            <textarea id="iracConclusion" class="irac-textarea" rows="3" placeholder="State the conclusion or prayer for relief on this issue."></textarea>
                        </div>

                        <!-- AI Review Button -->
                        <div class="ai-review-bar">
                            <button class="btn-ai btn-ai-review" id="aiReviewBtn" title="Get AI feedback on this IRAC block">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                                AI Review
                            </button>
                            <button class="btn-ai btn-ai-counter" id="aiCounterBtn" title="Simulate opposing arguments">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                                Counter-Argument
                            </button>
                            <span class="ai-label-tag">AI Guidance</span>
                        </div>

                        <!-- AI Review Output -->
                        <div class="ai-output-panel hidden" id="aiReviewOutput">
                            <div class="ai-output-header">
                                <span class="ai-output-title">AI Review</span>
                                <button class="btn-close" id="closeAiReview">&times;</button>
                            </div>
                            <div class="ai-output-body" id="aiReviewBody">
                                <!-- Populated by JS -->
                            </div>
                        </div>

                        <!-- Counter-Argument Output -->
                        <div class="ai-output-panel hidden" id="aiCounterOutput">
                            <div class="ai-output-header">
                                <span class="ai-output-title">Counter-Argument Simulator</span>
                                <button class="btn-close" id="closeAiCounter">&times;</button>
                            </div>
                            <div class="ai-output-body" id="aiCounterBody">
                                <!-- Populated by JS -->
                            </div>
                        </div>

                        <div class="irac-save-indicator" id="iracSaveIndicator">All changes saved</div>
                    </div>
                </div>
            </div>

            <!-- AI Coach Panel (slide-out, student side) -->
            <div class="ai-coach-panel hidden" id="aiCoachPanel">
                <div class="ai-coach-header">
                    <div class="ai-coach-title-row">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                        <span>AI Moot Coach</span>
                    </div>
                    <button class="btn-close" id="closeCoachBtn">&times;</button>
                </div>
                <div class="ai-coach-info">Ask questions about your preparation. The coach will guide your thinking without writing for you.</div>
                <div class="ai-coach-messages" id="aiCoachMessages">
                    <!-- Chat messages appear here -->
                </div>
                <div class="ai-coach-input-area">
                    <textarea id="aiCoachInput" class="ai-coach-textarea" rows="2" placeholder="e.g. Is my Rule section too generic?"></textarea>
                    <button class="btn-ai btn-ai-send" id="aiCoachSendBtn">Ask Coach</button>
                </div>
            </div>

            <!-- Judge Assist Panel (separate, toggleable) -->
            <div class="judge-assist-overlay hidden" id="judgeAssistOverlay">
                <div class="judge-assist-panel">
                    <div class="judge-assist-header">
                        <a href="./case-simplifier.html" class="nav-item">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                                <line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                            <span>Case Simplifier</span>
                        </a>
                        <a href="./ai-practice.html" class="nav-item">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                                <line x1="12" y1="19" x2="12" y2="23"/>
                                <line x1="8" y1="23" x2="16" y2="23"/>
                            </svg>
                            <span>ðŸ¤– AI Practice</span>
                        </a>
                        <span class="ai-label-tag">Advisory Only</span>
                    </div>
                    <button class="btn-close" id="closeJudgeAssist">&times;</button>
                </div>
                <div class="judge-assist-info">AI-assisted analysis for evaluators. All output is advisory. Final scores and decisions remain yours.</div>
                <div class="judge-assist-modes">
                    <button class="btn-ai judge-mode-btn active" data-mode="summarize">Summarize</button>
                    <button class="btn-ai judge-mode-btn" data-mode="compare">Compare</button>
                    <button class="btn-ai judge-mode-btn" data-mode="scoring_rationale">Scoring Rationale</button>
                </div>
                <div class="judge-assist-body" id="judgeAssistBody">
                    <p class="judge-assist-placeholder">Select a mode and click "Run Analysis" to begin.</p>
                </div>
                <div class="judge-assist-actions">
                    <button class="btn-ai btn-ai-send" id="judgeAssistRunBtn">Run Analysis</button>
                        <button class="btn-ai judge-mode-btn active" data-mode="summarize">Summarize</button>
                        <button class="btn-ai judge-mode-btn" data-mode="compare">Compare</button>
                        <button class="btn-ai judge-mode-btn" data-mode="scoring_rationale">Scoring Rationale</button>
                    </div>
                    <div class="judge-assist-body" id="judgeAssistBody">
                        <p class="judge-assist-placeholder">Select a mode and click "Run Analysis" to begin.</p>
                    </div>
                    <div class="judge-assist-actions">
                        <button class="btn-ai btn-ai-send" id="judgeAssistRunBtn">Run Analysis</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ==================== -->
        <!-- ORAL ROUND VIEW      -->
        <!-- ==================== -->
        <section id="oralRoundView" class="view hidden">
            <div class="oral-header">
                <div class="oral-nav">
                    <button class="btn-text" id="backToWorkspaceBtn">&larr; Back to Workspace</button>
                </div>
                <div class="oral-meta">
                    <h2 class="oral-title">Oral Round</h2>
                    <div class="oral-badges">
                        <span class="badge badge-stage" id="oralStageBadge">Setup</span>
                        <span class="badge badge-role" id="oralRoleBadge">Judge View</span>
                    </div>
                </div>
                <div class="oral-actions">
                    <button class="btn-icon" id="oralViewTranscriptBtn" title="View Transcript">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
                        <span>Transcript</span>
                    </button>
                    <button class="btn-icon btn-danger" id="endOralRoundBtn" title="End Round">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                        <span>End</span>
                    </button>
                </div>
            </div>

            <!-- Role Switcher (for practice mode) -->
            <div class="oral-role-bar" id="oralRoleBar">
                <span class="oral-role-label">View as:</span>
                <button class="oral-role-btn active" data-role="judge" id="roleJudgeBtn">Judge</button>
                <button class="oral-role-btn" data-role="speaker" id="roleSpeakerBtn">Speaker</button>
            </div>

            <!-- Round Setup Panel (shown before round starts) -->
            <div class="oral-setup-panel" id="oralSetupPanel">
                <h3>Configure Oral Round</h3>
                <div class="oral-setup-grid">
                    <div class="oral-setup-item">
                        <label>Petitioner Time (minutes)</label>
                        <input type="number" id="petitionerTime" value="10" min="1" max="30">
                    </div>
                    <div class="oral-setup-item">
                        <label>Respondent Time (minutes)</label>
                        <input type="number" id="respondentTime" value="10" min="1" max="30">
                    </div>
                    <div class="oral-setup-item">
                        <label>Rebuttal Time (minutes)</label>
                        <input type="number" id="rebuttalTime" value="3" min="1" max="10">
                    </div>
                </div>
                <button class="btn-primary btn-large" id="startOralRoundBtn">Start Oral Round</button>
            </div>

            <!-- Active Round Panel -->
            <div class="oral-round-panel hidden" id="oralRoundPanel">
                <!-- Timer Display -->
                <div class="oral-timer-section">
                    <div class="oral-timer-display" id="oralTimerDisplay">10:00</div>
                    <div class="oral-timer-status" id="oralTimerStatus">Ready</div>
                    <div class="oral-timer-controls">
                        <button class="btn-timer" id="pauseTimerBtn" title="Pause/Resume">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
                        </button>
                        <button class="btn-timer" id="nextStageBtn" title="Next Stage">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
                            Skip
                        </button>
                    </div>
                </div>

                <!-- Stage Indicator -->
                <div class="oral-stage-bar">
                    <div class="oral-stage-item active" data-stage="petitioner" id="stagePetitioner">
                        <span class="stage-dot"></span>
                        <span class="stage-label">Petitioner</span>
                    </div>
                    <div class="oral-stage-item" data-stage="respondent" id="stageRespondent">
                        <span class="stage-dot"></span>
                        <span class="stage-label">Respondent</span>
                    </div>
                    <div class="oral-stage-item" data-stage="rebuttal" id="stageRebuttal">
                        <span class="stage-dot"></span>
                        <span class="stage-label">Rebuttal</span>
                    </div>
                </div>

                <!-- Main Content Area -->
                <div class="oral-content-layout">
                    <!-- Left: Current Issue & Response Area -->
                    <div class="oral-speaker-panel" id="oralSpeakerPanel">
                        <div class="oral-issue-selector">
                            <label>Current Issue</label>
                            <select id="oralIssueSelect">
                                <option value="">Select an issue to address...</option>
                            </select>
                        </div>

                        <div class="oral-response-area" id="oralResponseArea">
                            <div class="oral-response-header">
                                <span class="oral-speaker-label" id="oralSpeakerLabel">Petitioner Speaking</span>
                                <span class="oral-timestamp" id="oralTimestamp"></span>
                            </div>
                            <textarea id="oralResponseInput" class="oral-response-input" rows="12" placeholder="Type your oral submissions here..."></textarea>
                            <div class="oral-response-hint">Press Enter to submit. Responses are timestamped and cannot be edited.</div>
                        </div>

                        <!-- Submitted Responses Log -->
                        <div class="oral-responses-log" id="oralResponsesLog">
                            <h4>Submitted Responses</h4>
                            <div class="oral-responses-list" id="oralResponsesList"></div>
                        </div>
                    </div>

                    <!-- Right: Bench Panel (Judge View) -->
                    <div class="oral-bench-panel" id="oralBenchPanel">
                        <div class="oral-bench-header">
                            <h4>Bench Questions</h4>
                            <span class="oral-bench-status" id="benchStatus">Active</span>
                        </div>

                        <!-- AI Question Suggestions (advisory) -->
                        <div class="oral-ai-suggestions" id="oralAiSuggestions">
                            <div class="oral-ai-header">
                                <span>AI Suggested Questions</span>
                                <span class="ai-label-tag">Advisory</span>
                            </div>
                            <div class="oral-ai-list" id="oralAiList">
                                <p class="oral-ai-placeholder">Click "Generate Suggestions" for AI bench question ideas.</p>
                            </div>
                            <button class="btn-ai btn-ai-sm" id="generateAiQuestionsBtn">Generate Suggestions</button>
                        </div>

                        <!-- Ask Question Form -->
                        <div class="oral-question-form">
                            <textarea id="benchQuestionInput" class="oral-question-input" rows="3" placeholder="Type your bench question here..."></textarea>
                            <button class="btn-primary" id="askQuestionBtn">Ask Question</button>
                        </div>

                        <!-- Active Question Display -->
                        <div class="oral-active-question hidden" id="oralActiveQuestion">
                            <div class="oral-question-header">
                                <span>Pending Question</span>
                                <span class="oral-timer-paused">TIMER PAUSED</span>
                            </div>
                            <div class="oral-question-text" id="oralQuestionText"></div>
                            <button class="btn-secondary" id="clearQuestionBtn">Clear & Resume</button>
                        </div>

                        <!-- Question History -->
                        <div class="oral-question-history" id="oralQuestionHistory">
                            <h4>Question History</h4>
                            <div class="oral-history-list" id="oralHistoryList"></div>
                        </div>

                        <!-- Judge Private Notes -->
                        <div class="oral-judge-notes">
                            <h4>Private Notes <span class="oral-private-tag">Judge Only</span></h4>
                            <textarea id="judgeNotesInput" class="oral-notes-input" rows="6" placeholder="Add private notes here. Not visible to speakers."></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transcript Modal -->
            <div class="oral-transcript-overlay hidden" id="oralTranscriptOverlay">
                <div class="oral-transcript-panel">
                    <div class="oral-transcript-header">
                        <h3>Round Transcript</h3>
                        <div class="oral-transcript-actions">
                            <button class="btn-ai" id="downloadTranscriptBtn">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                Download
                            </button>
                            <button class="btn-close" id="closeTranscriptBtn">&times;</button>
                        </div>
                    </div>
                    <div class="oral-transcript-body" id="oralTranscriptBody"></div>
                </div>
            </div>

            <!-- Evaluation Panel (Phase 4) -->
            <div class="evaluation-overlay hidden" id="evaluationOverlay">
                <div class="evaluation-panel">
                    <div class="evaluation-header">
                        <div class="evaluation-title-row">
                            <h2>Moot Evaluation</h2>
                            <span class="badge badge-role" id="evalStatusBadge">Draft</span>
                        </div>
                        <div class="evaluation-actions">
                            <button class="btn-secondary" id="saveDraftEvalBtn">Save Draft</button>
                            <button class="btn-primary" id="finalizeEvalBtn">Finalize Evaluation</button>
                            <button class="btn-close" id="closeEvalBtn">&times;</button>
                        </div>
                    </div>

                    <div class="evaluation-content">
                        <!-- Left: Submission Review -->
                        <div class="eval-review-panel">
                            <div class="eval-section-tabs">
                                <button class="eval-tab active" data-tab="written">Written Submissions</button>
                                <button class="eval-tab" data-tab="oral" id="oralTabBtn">Oral Round</button>
                                <button class="eval-tab" data-tab="transcript">Transcript</button>
                            </div>

                            <!-- Written Submissions View -->
                            <div class="eval-tab-content active" id="writtenTab">
                                <div class="eval-issues-list" id="evalIssuesList">
                                    <!-- Populated by JS -->
                                </div>
                            </div>

                            <!-- Oral Round View -->
                            <div class="eval-tab-content" id="oralTab">
                                <div class="eval-oral-summary" id="evalOralSummary">
                                    <p class="eval-placeholder">No oral round recorded for this moot.</p>
                                </div>
                            </div>

                            <!-- Transcript View -->
                            <div class="eval-tab-content" id="transcriptTab">
                                <div class="eval-transcript" id="evalTranscript">
                                    <p class="eval-placeholder">No transcript available.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Right: Scoring Panel -->
                        <div class="eval-scoring-panel">
                            <div class="eval-scoring-header">
                                <h3>Scoring Rubric</h3>
                                <span class="ai-label-tag">Judge Controlled</span>
                            </div>

                            <!-- Judge Identity -->
                            <div class="eval-judge-id">
                                <label>Judge Name/ID</label>
                                <input type="text" id="judgeIdInput" placeholder="Enter your name or ID">
                            </div>

                            <!-- Scoring Categories -->
                            <div class="eval-categories" id="evalCategories">
                                <!-- Populated by JS -->
                            </div>

                            <!-- Overall Comments -->
                            <div class="eval-overall">
                                <h4>Overall Comments</h4>
                                <textarea id="overallComments" rows="4" placeholder="Enter your overall assessment..."></textarea>
                            </div>

                            <!-- AI Feedback Assist -->
                            <div class="eval-ai-assist" id="evalAiAssist">
                                <div class="eval-ai-header">
                                    <span>AI Feedback Assist</span>
                                    <span class="ai-label-tag">Advisory Only</span>
                                </div>
                                <div class="eval-ai-content" id="evalAiContent">
                                    <p class="eval-ai-placeholder">Click "Suggest Feedback" for AI assistance with phrasing.</p>
                                </div>
                                <button class="btn-ai btn-ai-sm" id="suggestFeedbackBtn">Suggest Feedback</button>
                            </div>

                            <!-- Score Summary -->
                            <div class="eval-summary">
                                <div class="eval-total-score">
                                    <span class="eval-total-label">Total Score:</span>
                                    <span class="eval-total-value" id="totalScore">0</span>
                                    <span class="eval-max-value" id="maxScore">/ 50</span>
                                </div>
                                <div class="eval-percentage" id="scorePercentage">0%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Multi-Judge Summary (shown if multiple evaluations exist) -->
                    <div class="eval-multi-judge hidden" id="multiJudgePanel">
                        <h4>Multi-Judge Summary</h4>
                        <div class="eval-judges-list" id="judgesList"></div>
                        <div class="eval-aggregate" id="aggregateScores"></div>
                    </div>
                </div>
            </div>

            <!-- Feedback Report Modal -->
            <div class="feedback-report-overlay hidden" id="feedbackReportOverlay">
                <div class="feedback-report-panel">
                    <div class="feedback-header">
                        <h2>Feedback Report</h2>
                        <div class="feedback-actions">
                            <button class="btn-ai" id="downloadFeedbackBtn">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                Download PDF
                            </button>
                            <button class="btn-close" id="closeFeedbackBtn">&times;</button>
                        </div>
                    </div>
                    <div class="feedback-body" id="feedbackBody">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay hidden" id="issueModal">
        <div class="modal-box">
            <h3 id="issueModalTitle">Add Legal Issue</h3>
            <div class="form-group">
                <label class="form-label" for="issueText">Issue Statement</label>
                <textarea id="issueText" class="form-textarea" rows="3" placeholder="e.g. Whether the fundamental right to privacy under Article 21 was violated by the impugned legislation."></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" id="cancelIssueBtn">Cancel</button>
                <button class="btn-primary" id="saveIssueBtn">Save Issue</button>
            </div>
        </div>
    </div>

    <script src="../js/auth.js"></script>
    <script src="../js/moot-court.js"></script>
    
    <!-- Phase 5A: Role-based UI initialization -->
    <script>
    (function() {
        // Require authentication
        if (!window.auth.isAuthenticated()) {
            window.location.href = '/html/login.html?redirect=' + encodeURIComponent(window.location.pathname);
            return;
        }
        
        // Get current user role
        const userRole = window.auth.getUserRole();
        const ROLES = window.auth.ROLES;
        
        // Role-based UI adjustments
        document.addEventListener('DOMContentLoaded', function() {
            // STUDENT ONLY: AI Coach, AI Review, Counter-Argument
            if (!window.auth.hasPermission('AI_COACH')) {
                const coachBtn = document.getElementById('toggleCoachBtn');
                if (coachBtn) coachBtn.style.display = 'none';
            }
            
            if (!window.auth.hasPermission('AI_REVIEW')) {
                const reviewBtn = document.getElementById('aiReviewBtn');
                if (reviewBtn) reviewBtn.style.display = 'none';
            }
            
            if (!window.auth.hasPermission('COUNTER_ARGUMENT')) {
                const counterBtn = document.getElementById('aiCounterBtn');
                if (counterBtn) counterBtn.style.display = 'none';
            }
            
            // JUDGE AND ABOVE: Judge Assist, Evaluation, Bench Questions
            if (!window.auth.hasPermission('JUDGE_ASSIST')) {
                const judgeAssistBtn = document.getElementById('toggleJudgeAssistBtn');
                if (judgeAssistBtn) judgeAssistBtn.style.display = 'none';
            }
            
            if (!window.auth.hasPermission('EVALUATE_AND_SCORE')) {
                const evalBtn = document.getElementById('openEvaluationBtn');
                if (evalBtn) evalBtn.style.display = 'none';
            }
            
            // STUDENT: Can create projects
            if (!window.auth.hasPermission('CREATE_PROJECT')) {
                const newProjectBtn = document.getElementById('newProjectBtn');
                const emptyNewProjectBtn = document.getElementById('emptyNewProjectBtn');
                if (newProjectBtn) newProjectBtn.style.display = 'none';
                if (emptyNewProjectBtn) emptyNewProjectBtn.style.display = 'none';
            }
            
            // ORAL ROUNDS: Students can be speakers, Judges can be bench
            const roleJudgeBtn = document.getElementById('roleJudgeBtn');
            const roleSpeakerBtn = document.getElementById('roleSpeakerBtn');
            
            if (window.auth.hasPermission('ORAL_ROUND_SPEAKER') && roleSpeakerBtn) {
                roleSpeakerBtn.style.display = 'inline-flex';
            } else if (roleSpeakerBtn) {
                roleSpeakerBtn.style.display = 'none';
            }
            
            if (window.auth.hasPermission('ORAL_ROUND_BENCH') && roleJudgeBtn) {
                roleJudgeBtn.style.display = 'inline-flex';
            } else if (roleJudgeBtn) {
                roleJudgeBtn.style.display = 'none';
            }
            
            // Log role info for debugging
            console.log('Phase 5A: Moot Court loaded with role:', userRole);
        });
    })();
    </script>
</body>
</html>
